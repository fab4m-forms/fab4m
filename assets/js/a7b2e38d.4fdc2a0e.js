"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2986],{1537:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const l={},i="Working with fab4m in Laravel",o={permalink:"/blog/2022/12/16/fab4m-and-laravel",source:"@site/blog/2022-12-16-fab4m-and-laravel.md",title:"Working with fab4m in Laravel",description:"This is the first part in a blog series about how you can use fab4m together",date:"2022-12-16T00:00:00.000Z",formattedDate:"December 16, 2022",tags:[],readingTime:6.73,hasTruncateMarker:!1,authors:[],frontMatter:{},nextItem:{title:"Hello world!",permalink:"/blog/2022/12/11/hello-world"}},s={authorsImageUrls:[]},p=[{value:"Installing laravel",id:"installing-laravel",level:2},{value:"Getting everything in place with docker",id:"getting-everything-in-place-with-docker",level:2},{value:"Setting up laravel breeze",id:"setting-up-laravel-breeze",level:2},{value:"Running the migrations",id:"running-the-migrations",level:2},{value:"Try it out",id:"try-it-out",level:2},{value:"Install fab4m",id:"install-fab4m",level:2},{value:"Make a diary model, migration and controller",id:"make-a-diary-model-migration-and-controller",level:2},{value:"Let&#39;s fill in the blanks!",id:"lets-fill-in-the-blanks",level:2},{value:"Setting up the fab4m form",id:"setting-up-the-fab4m-form",level:2},{value:"Saving your laravel model",id:"saving-your-laravel-model",level:2},{value:"And that&#39;s it!",id:"and-thats-it",level:2},{value:"Generating the JSON Schema",id:"generating-the-json-schema",level:2},{value:"Using the JSON schema for validation",id:"using-the-json-schema-for-validation",level:2},{value:"That&#39;s a wrap!",id:"thats-a-wrap",level:2}],u={toc:p};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This is the first part in a blog series about how you can use fab4m together\nwith different backend frameworks."),(0,r.kt)("p",null,"At my current workplace (",(0,r.kt)("a",{parentName:"p",href:"https://leanlab.co/"},"Leanlab.co"),") we use Laravel as our web framework and we are veryhappy with it. That's why it's only natural to start there!"),(0,r.kt)("p",null,"In this blog post we are going to set up a laravel installation with\n",(0,r.kt)("a",{parentName:"p",href:"https://laravel.com/docs/9.x/starter-kits#laravel-breeze"},"Laravel\nbreeze"),", a\nstarter kit for laravel that provides you with a solid boilerplate to\nstart building any app."),(0,r.kt)("p",null,"To get things integrated with react we are using ",(0,r.kt)("a",{parentName:"p",href:"https://inertiajs.com/"},"Inertja.js"),", a way to easily tie your react frontend together with your backend."),(0,r.kt)("h2",{id:"installing-laravel"},"Installing laravel"),(0,r.kt)("p",null,"Have a look at the ",(0,r.kt)("a",{parentName:"p",href:"https://laravel.com/docs/9.x/installation"},"Laravel installation guide")," for the full details,\nbut in short, if you have ",(0,r.kt)("a",{parentName:"p",href:"https://php.net"},"php"),", ",(0,r.kt)("a",{parentName:"p",href:"https://getcomposer.org/"},"composer")," and ",(0,r.kt)("a",{parentName:"p",href:"https://nodejs.org/en/"},"node")," installed you can go ahead:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"composer create-project laravel/laravel fab4m-example\n")),(0,r.kt)("p",null,"This will get you started with a blank laravel project."),(0,r.kt)("h2",{id:"getting-everything-in-place-with-docker"},"Getting everything in place with docker"),(0,r.kt)("p",null,"I usually work with docker to get things like mysql and other related services going.\nLuckily laravel provides us with an easy way to do that called ",(0,r.kt)("a",{parentName:"p",href:"https://laravel.com/docs/9.x/sail"},"laravel sail"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"composer require laravel/sail --dev\nphp artisan sail:install\n")),(0,r.kt)("p",null,"This will install laravel sail and get everything configured for you!"),(0,r.kt)("p",null,"Now you can run:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"vendor/bin/sail up -d\n")),(0,r.kt)("p",null,"To get your full environment up and running."),(0,r.kt)("p",null,"Now, browse to http://localhost you should see your environment up and running!"),(0,r.kt)("h2",{id:"setting-up-laravel-breeze"},"Setting up laravel breeze"),(0,r.kt)("p",null,"Laravel breeze gives us a flying start with authentication and a nice setup\nto get you going with React. The starter kit gets you going with all the tooling\nyou need, pretty neat!"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"composer require laravel/breeze --dev\nphp artisan breeze:install react\n")),(0,r.kt)("h2",{id:"running-the-migrations"},"Running the migrations"),(0,r.kt)("p",null,"Laravel breeze provides you with a user model for authentication.\nYou can get the schema installed by migrating:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"vendor/bin/sail artisan migrate\n")),(0,r.kt)("h2",{id:"try-it-out"},"Try it out"),(0,r.kt)("p",null,"Visit: ",(0,r.kt)("a",{parentName:"p",href:"http://localhost/register"},"http://localhost/register")),(0,r.kt)("p",null,"You should see a form to register and you can perform the registration process!"),(0,r.kt)("h2",{id:"install-fab4m"},"Install fab4m"),(0,r.kt)("p",null,"Now it's time for the fun part, let's see how we can use fab4m to complement\nour already amazing stack! Let's begin by installing it:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install --save @fab4m/fab4m\n")),(0,r.kt)("h2",{id:"make-a-diary-model-migration-and-controller"},"Make a diary model, migration and controller"),(0,r.kt)("p",null,"Laravel provides us with a nice way of generating a lot of boilerplate code."),(0,r.kt)("p",null,"The following command creates:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A ",(0,r.kt)("a",{parentName:"li",href:"https://laravel.com/docs/9.x/eloquent"},"Laravel model")," for our diary posts"),(0,r.kt)("li",{parentName:"ul"},"A ",(0,r.kt)("a",{parentName:"li",href:"https://laravel.com/docs/9.x/migrations"},"Laravel migration")," for setting up the diary schema"),(0,r.kt)("li",{parentName:"ul"},"A ",(0,r.kt)("a",{parentName:"li",href:"https://laravel.com/docs/9.x/controllers#resource-controllers"},"Laravel resource controller")," for handling our CRUD operations.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"php artisan make:model Diary -c -m -r\n")),(0,r.kt)("h2",{id:"lets-fill-in-the-blanks"},"Let's fill in the blanks!"),(0,r.kt)("p",null,"Now we have some actual coding to do, finally!"),(0,r.kt)("p",null,"Let's start with our migration,there should be a file called ","[date]","-create_diaries_table.php in your database/migrations folder, edit the ",(0,r.kt)("inlineCode",{parentName:"p"},"up()")," function to this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"public function up()\n{\n    Schema::create('diaries', function (Blueprint $table) {\n        $table->id();\n        $table->text('title');\n        $table->text('body');\n        $table->json('tags')->nullable();\n        $table->timestamps();\n    });\n}\n")),(0,r.kt)("p",null,"This will create a database table with a title and body text field and a json field for storing tags for the diaries."),(0,r.kt)("p",null,"Next up, edit your model (",(0,r.kt)("inlineCode",{parentName:"p"},"app/Models/Diary.php"),") a bit:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"class Diary extends Model\n{\n    use HasFactory;\n\n    protected $fillable = ['title', 'body', 'tags'];\n    protected $casts = ['tags' => 'json'];\n}\n")),(0,r.kt)("p",null,"This will make the title, body and tags fillable when saving data.\nWe also indicate that the tags is json data so that it will be properly handled."),(0,r.kt)("p",null,"Then edit our controller to render an inertia javascript page for showing our form:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"public function create()\n{\n    return Inertia::render('Diary/Create', []);\n}\n")),(0,r.kt)("p",null,"Finally we need to register our new resource controller among our routes, this is done in routes/web.php file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"Route::resource('diaries', DiaryController::class);\n")),(0,r.kt)("p",null,"We're ready to render our form on the client side!"),(0,r.kt)("h2",{id:"setting-up-the-fab4m-form"},"Setting up the fab4m form"),(0,r.kt)("p",null,"Let's start with creating a fab4m form, create a file in resources/js/Forms/Diary.js:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},'import {\n    createForm,\n    textField,\n    textAreaWidget,\n    tagsWidget,\n} from "@fab4m/fab4m";\n\nexport default createForm({\n    title: textField({ label: "Title", required: true }),\n    body: textField({\n        label: "Body",\n        required: true,\n        widget: textAreaWidget(),\n    }),\n    tags: textField({\n        label: "Tags",\n        multiple: true,\n        multipleWidget: tagsWidget(),\n    }),\n});\n')),(0,r.kt)("p",null,"We create a simple form with a title and a body field, and we spice it up\nwith an autocomplete tags field. This allows us to re-use the form wherever we like."),(0,r.kt)("p",null,"With the form in hand we can now create our first Inertia page. Create the file ",(0,r.kt)("inlineCode",{parentName:"p"},"resources/js/Pages/Diary/Create.jsx"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},'import GuestLayout from "@/Layouts/GuestLayout";\nimport { Inertia } from "@inertiajs/inertia";\nimport { Head } from "@inertiajs/inertia-react";\nimport "@fab4m/fab4m/css/basic/basic.css";\nimport form from "../../Forms/Diary";\nimport { StatefulFormView } from "@fab4m/fab4m";\n\nexport default function Create() {\n    form.onSubmit((e, data) => {\n        e.preventDefault();\n        Inertia.post(route("diaries.store"), data);\n    });\n    return (\n        <GuestLayout>\n            <Head title="Create new diary" />\n            <h2 className="font-semibold text-xl text-gray-800 leading-tight">\n                Create new diary\n            </h2>\n            <div className="py-12">\n                <div className="max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6">\n                    <StatefulFormView form={form} />\n                </div>\n            </div>\n        </GuestLayout>\n    );\n}\n')),(0,r.kt)("p",null,"Notice that we add an ",(0,r.kt)("inlineCode",{parentName:"p"},"onSubmit()")," handler on the form. That handler is then used\nto submit our data back to laravel."),(0,r.kt)("p",null,"The GuestLayout is provided by the breeze boilerplate and provides\na basic header and footer. The real magic happens in our StatefulFormView where\nwe render the form. We use the ",(0,r.kt)("inlineCode",{parentName:"p"},"StatefulFormView")," component to render the form.\nThe state is then handled internally."),(0,r.kt)("p",null,"Visit ",(0,r.kt)("a",{parentName:"p",href:"http://localhost/diaries/create"},"http://localhost/diaries/create")),(0,r.kt)("p",null,"You should see our newly created form in action, and if you submit the\nform you will be presented with an error that your method for creating\nyour diary isn't returning anything."),(0,r.kt)("h2",{id:"saving-your-laravel-model"},"Saving your laravel model"),(0,r.kt)("p",null,"Head over to ",(0,r.kt)("inlineCode",{parentName:"p"},"app/Http/Controllers/DiaryController.php"),"and add the following to your ",(0,r.kt)("inlineCode",{parentName:"p"},"store")," method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"use use Illuminate\\Http\\Request;\nuse Illuminate\\Support\\Facades\\Redirect;\n\n...\n\npublic function store(Request $request)\n{\n    $diary = Diary::create($request->validate([\n          'title' => ['required', 'string'],\n          'body' => ['required', 'string'],\n          'tags' => ['nullable', 'array'],\n       ]));\n     return Redirect::route('diaries.show', [$diary->id]);\n}\n")),(0,r.kt)("p",null,"Once the form is saved you will be redirected to the show page. That page can be implemented the same way as the create page:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"public function show(Diary $diary)\n{\n    return Inertia::render('Diary/Show', ['diary' => $diary]);\n}\n")),(0,r.kt)("p",null,"Notice that we're sending the diary along. This diary is then available in the page component, ",(0,r.kt)("inlineCode",{parentName:"p"},"resources/views/js/Pages/Show.jsx"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},'import GuestLayout from "@/Layouts/GuestLayout";\nimport { Inertia } from "@inertiajs/inertia";\nimport { Head, Link } from "@inertiajs/inertia-react";\n\nexport default function Show({ diary }) {\n    return (\n        <GuestLayout>\n            <Head title={diary.title} />\n            <h2 className="font-semibold text-xl text-gray-800 leading-tight">\n                Diary: {diary.title}\n            </h2>\n            <div className="py-12">\n                <article className="max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6">\n                    <h3 class="font-bold">Entry</h3>\n                    <p className="mb-4">{diary.body}</p>\n                    <h3 class="font-bold">Tags</h3>\n                    <ul className="list-disc ml-8 mt-1">\n                        {diary.tags.map((tag, i) => (\n                            <li key={i}>{tag}</li>\n                        ))}\n                    </ul>\n                    <Link\n                        className="text-blue-700"\n                        href={route("diaries.edit", [diary.id])}\n                    >\n                        Edit\n                    </Link>\n                </article>\n            </div>\n        </GuestLayout>\n    );\n}\n')),(0,r.kt)("h2",{id:"and-thats-it"},"And that's it!"),(0,r.kt)("p",null,"We have a working example. If the form is this basic, you probably want to\nstick with Laravel validation, but if you want to utilize the full power of fab4m,\nyou can use JSON schema instead to validate your submission. Let's explode how that would look like."),(0,r.kt)("h2",{id:"generating-the-json-schema"},"Generating the JSON Schema"),(0,r.kt)("p",null,"You can generate a json schema from any form by using the ",(0,r.kt)("inlineCode",{parentName:"p"},"generateSchema")," function:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"console.log(JSON.stringify(generateSchema(form)));\n")),(0,r.kt)("p",null,"The output from this function will be the json schema that you can use to validate your form anywhere."),(0,r.kt)("p",null,"Add the schema to your function:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'class DiaryController extends Controller\n{\n    private string $schema = <<<JSON\n{"title":"Form data","description":"A form submission","type":"object","properties":{"title":{"type":"string","title":"Title","minLength":1},"body":{"type":"string","title":"Title","minLength":1},"tags":{"type":"array","title":"Tags","items":{"type":"string","title":"Tags"},"minItems":0}},"required":["title","body"],"dependencies":{}}\nJSON;\n\n...\n\n}\n')),(0,r.kt)("p",null,"With the schema in place, you can use any json schema validator to validate it. Here we use the ",(0,r.kt)("a",{parentName:"p",href:"https://opis.io/json-schema"},"opis json-schema package"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"composer require opis/json-schema\n")),(0,r.kt)("h2",{id:"using-the-json-schema-for-validation"},"Using the JSON schema for validation"),(0,r.kt)("p",null,"Now that we have our schema available we can use the json schema validator\ninstead of the native laravel validation to do the work for us:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'public function store(Request $request)\n{\n  $validator = new Validator();\n  $result = $validator->validate((object)$request->all(), $this->schema);\n  if (!$result->isValid()) {\n    abort(422, (new ErrorFormatter())->format($result->error()));\n  }\n  $diary = Diary::create(\n    $request->all();\n  );\n  return Redirect::route("diaries.show", [$diary->id]);\n}\n')),(0,r.kt)("h2",{id:"thats-a-wrap"},"That's a wrap!"),(0,r.kt)("p",null,"This is an example of how to integrate fab4m into a Laravel app.\nThis example wasn't particularly exciting in terms of form building,\nso in the next blog post I will expand on this application to include\nsomething that would be more of a challenge!"),(0,r.kt)("p",null,"The full source code for this blog post is available ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fab4m-forms/fab4m-laravel-example"},"here"),"."))}d.isMDXComponent=!0}}]);